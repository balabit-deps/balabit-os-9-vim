Backport:

Test removed due to significantly increasing the build time.

---

From 44a3f3353e0407e9fffee138125a6927d1c9e7e5 Mon Sep 17 00:00:00 2001
From: Bram Moolenaar <Bram@vim.org>
Date: Mon, 6 Jun 2022 15:38:21 +0100
Subject: [PATCH] patch 8.2.5063: error for a command may go over the end of
 IObuff

Problem:    Error for a command may go over the end of IObuff.
Solution:   Truncate the message.

---

Index: vim-7.4.1689/src/ex_docmd.c
===================================================================
--- vim-7.4.1689.orig/src/ex_docmd.c
+++ vim-7.4.1689/src/ex_docmd.c
@@ -3054,9 +3054,17 @@ checkforcmd(
     static void
 append_command(char_u *cmd)
 {
-    char_u *s = cmd;
-    char_u *d;
+    size_t  len = STRLEN(IObuff);
+    char_u  *s = cmd;
+    char_u  *d;
 
+    if (len > IOSIZE - 100)
+    {
+	// Not enough space, truncate and put in "...".
+	d = IObuff + IOSIZE - 100;
+	d -= mb_head_off(IObuff, d);
+	STRCPY(d, "...");
+    }
     STRCAT(IObuff, ": ");
     d = IObuff + STRLEN(IObuff);
     while (*s != NUL && d - IObuff + 5 < IOSIZE)
