From 0e8e938d497260dd57be67b4966cb27a5f72376f Mon Sep 17 00:00:00 2001
From: Bram Moolenaar <Bram@vim.org>
Date: Sat, 18 Jun 2022 12:51:11 +0100
Subject: [PATCH] patch 8.2.5122: lisp indenting my run over the end of the
 line

Problem:    Lisp indenting my run over the end of the line.
Solution:   Check for NUL earlier.
---
 src/indent.c                |  2 ++
 src/testdir/test_indent.vim | 10 ++++++++++
 src/version.c               |  2 ++
 3 files changed, 14 insertions(+)

--- vim-8.2.3995.orig/src/indent.c
+++ vim-8.2.3995/src/indent.c
@@ -1957,6 +1957,8 @@ get_lisp_indent(void)
 			    }
 			}
 		    }
+		    if (*that == NUL)
+			break;
 		}
 		if (*that == '(' || *that == '[')
 		    ++parencount;
--- vim-8.2.3995.orig/src/testdir/test_indent.vim
+++ vim-8.2.3995/src/testdir/test_indent.vim
@@ -121,6 +121,16 @@ func Test_lisp_indent()
   close!
 endfunc
 
+func Test_lisp_indent_quoted()
+  " This was going past the end of the line
+  new
+  setlocal lisp autoindent
+  call setline(1, ['"[', '='])
+  normal Gvk=
+
+  bwipe!
+endfunc
+
 " Test for setting the 'indentexpr' from a modeline
 func Test_modeline_indent_expr()
   let modeline = &modeline
