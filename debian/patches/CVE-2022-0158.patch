[Ubuntu note: Removed changes made to version.c because they were not needed
 to fix the vulnerability.
 -- Evan Caville <evan.caville@canonical.com>]

From 5f25c3855071bd7e26255c68bf458b1b5cf92f39 Mon Sep 17 00:00:00 2001
From: Bram Moolenaar <Bram@vim.org>
Date: Sun, 9 Jan 2022 13:36:28 +0000
Subject: [PATCH] patch 8.2.4049: Vim9: reading before the start of the line
 with "$"

Problem:    Vim9: reading before the start of the line with "$" by itself.
Solution:   Do not subtract one when reporting the error.
---
 src/testdir/test_vim9_expr.vim | 1 +
 src/version.c                  | 2 ++
 src/vim9expr.c                 | 2 +-
 3 files changed, 4 insertions(+), 1 deletion(-)

--- a/src/testdir/test_vim9_expr.vim
+++ b/src/testdir/test_vim9_expr.vim
@@ -2853,6 +2853,7 @@
   CheckDefAndScriptSuccess(lines)
 
   CheckDefAndScriptFailure(["var x = $$$"], ['E1002:', 'E15:'], 1)
+  CheckDefAndScriptFailure(["$"], ['E1002:', 'E15:'], 1)
 enddef
 
 def Test_expr7_register()
--- a/src/vim9expr.c
+++ b/src/vim9expr.c
@@ -1221,7 +1221,7 @@
     len = get_env_len(arg);
     if (len == 0)
     {
-	semsg(_(e_syntax_error_at_str), start - 1);
+	semsg(_(e_syntax_error_at_str), start);
 	return FAIL;
     }
 
